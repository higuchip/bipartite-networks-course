---
title: "An√°lise de Redes Ecol√≥gicas Bipartidas"
subtitle: "Ferramentas para Conserva√ß√£o e Restaura√ß√£o"
author: "Prof. Pedro Higuchi"
institute: "PPGEF - UDESC"
date: "2025-11-17"
format:
  revealjs:
    theme: [default, custom.css]
    transition: fade
    slide-number: c/t
    chalkboard: false
    preview-links: false
    footer: "PPGEF/UDESC"
    smaller: false
    scrollable: false
    controls: false
    progress: true
    history: true
    center: false
    touch: true
    loop: false
    rtl: false
    navigation-mode: linear
    keyboard: true
    hash-one-based-index: false
    respond-to-hash-changes: true
    jump-to-slide: true
    view-distance: 3
    mobile-view-distance: 2
    width: 1400
    height: 900
    margin: 0.1
    menu:
      side: left
      width: normal
    title-slide-attributes:
      data-background-image: "index_files/hex_sticker.png"
      data-background-size: "20%"
      data-background-position: "95% 5%"
      data-background-opacity: "0.9"
execute:
  echo: true
  warning: false
  message: false
  cache: false
---

```{r setup, include=FALSE}
# Verificar e instalar pacotes necess√°rios
pacotes <- c("bipartite", "igraph", "vegan", "dplyr", "ggplot2", "knitr", "DiagrammeR")
novos_pacotes <- pacotes[!(pacotes %in% installed.packages()[,"Package"])]
if(length(novos_pacotes)) install.packages(novos_pacotes)

# Carregar pacotes
library(bipartite)
library(igraph)
library(vegan)
library(dplyr)
library(ggplot2)
library(knitr)
library(DiagrammeR)

# Configura√ß√µes
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.align = "center",
  fig.width = 12,
  fig.height = 8
)

# Seed para reprodutibilidade
set.seed(42)
```

# Parte 1: Introdu√ß√£o {.center background-color="#2C5F2D"}

## Neste curso...

**O que vamos aprender?**

-   Hist√≥ria e contexto das redes ecol√≥gicas
-   Conceitos fundamentais e m√©tricas
-   Aplica√ß√µes pr√°ticas com R

**Objetivos de Aprendizagem**

1.  Compreender a estrutura de redes bipartidas
2.  Calcular e interpretar m√©tricas ecol√≥gicas
3.  Aplicar modelos nulos
4.  Identificar esp√©cies-chave para conserva√ß√£o

## Uma Hist√≥ria Real: O Mist√©rio de Darwin

**Madagascar, 1862**

![](Angraecum_sesquipedale_Thouars,_Hist._Orchid._66_(1822)_(45713158794).jpg){width="60%"}

-   Darwin recebe a orqu√≠dea *Angraecum sesquipedale*
-   Nect√°rio de **30 cm** de profundidade!
-   **Previs√£o ousada:** Deve existir uma mariposa com espirotromba de 30 cm

**A comunidade cient√≠fica era c√©tica...**

::: image-credits
**Cr√©dito:** ¬© sunoochi, Sapporo (CC BY 2.0)
:::

## A Descoberta: 41 Anos Depois

**Madagascar, 1903**

![](Xanthopan_morganii_praedicta_Sep_16_2021_03-58PM.jpeg){width="60%"}

-   Descoberta de *Xanthopan morganii praedicta*
-   Espirotromba de exatos **30 cm** - exatamente como previsto!
-   Nome da subesp√©cie: *praedicta* (do latim "predito")

**Primeira evid√™ncia cient√≠fica de coevolu√ß√£o**

::: image-credits
**Cr√©dito:** ¬© Nesnad (CC BY 4.0)
:::

## A Li√ß√£o de Darwin

> "Esp√©cies n√£o evoluem isoladamente: elas se transformam em resposta √†s press√µes exercidas umas pelas outras ao longo de milh√µes de anos."

**Implica√ß√µes:**

-   Plantas e animais evoluem em resposta uns aos outros
-   Perder um parceiro pode levar √† extin√ß√£o do outro
-   **Redes de intera√ß√£o s√£o essenciais para a conserva√ß√£o**

## Por que Estudar Redes de Intera√ß√£o? ü§î

**Quatro raz√µes fundamentais:**

1.  üî¨ Entender a natureza
2.  üõ°Ô∏è Conservar biodiversidade\
3.  üåæ Servi√ßos ecossist√™micos
4.  üå≤ Aplica√ß√µes profissionais

## 1. Entender a Organiza√ß√£o da Natureza üî¨

**Perguntas fundamentais:**

-   Como esp√©cies coexistem?
-   Quem interage com quem?
-   Existem padr√µes universais?

**Por que importa:**\
Base te√≥rica para todas as aplica√ß√µes pr√°ticas

## 2. Conserva√ß√£o da Biodiversidade üõ°Ô∏è

**Perguntas pr√°ticas:**

-   Quais esp√©cies s√£o mais importantes?
-   O que acontece se uma esp√©cie desaparecer?
-   Como restaurar ecossistemas?

## 3. Servi√ßos Ecossist√™micos üåæ

**Dispers√£o de sementes:** - Viabiliza regenera√ß√£o natural - Economia: plantio total (US\$ 2.000-3.000/ha) (Brancalion et al. 2019)

**Poliniza√ß√£o:** - R\$ 43 bilh√µes/ano no Brasil (Wolowski et al., 2019)

**Controle biol√≥gico:** - Preju√≠zo causado pela vespa da madeira: US\$ 53 milh√µes/ano (Embrapa)

## 4. Aplica√ß√µes em Engenharia Florestal üå≤

**√Åreas de atua√ß√£o:**

-   [x] **Restaura√ß√£o** - Sele√ß√£o de esp√©cies por fun√ß√£o (redu√ß√£o de custos)
-   [x] **Manejo de UCs** - Diagn√≥stico e monitoramento funcional
-   [x] **SAF e Silvicultura** - Desenho de sistemas produtivos
-   [x] **Licenciamento ambiental** - Avalia√ß√£o de impactos funcionais em EIA/RIMA
-   [x] **Manejo de PFNM** - Conserva√ß√£o de processos ecol√≥gicos (dispers√£o, poliniza√ß√£o)

**Mercado:** 12 milh√µes de ha a restaurar at√© 2030 (NDC Brasil - Acordo de Paris, 2016)

## Hist√≥ria das Redes Ecol√≥gicas

**Anos 1920-1950: Primeiras Observa√ß√µes** - Teias alimentares e cadeias tr√≥ficas - Primeiras redes de poliniza√ß√£o documentadas

**Anos 1970-1980: Formaliza√ß√£o Matem√°tica** - Modelos de estabilidade de redes - An√°lise estrutural de teias alimentares

## Hist√≥ria das Redes Ecol√≥gicas

**Anos 1990-2000: Era Digital** - Descoberta de padr√µes de aninhamento - M√©tricas de especializa√ß√£o em redes

**Anos 2010-presente: Big Data** - An√°lises globais de redes - Impactos das mudan√ßas clim√°ticas - Din√¢mica temporal de intera√ß√µes

## O que s√£o Redes Ecol√≥gicas?

**Defini√ß√£o:**

> "Representa√ß√£o gr√°fica de quem interage com quem em uma comunidade ecol√≥gica"

**Componentes:**

-   **N√≥s (v√©rtices):** Esp√©cies
-   **Liga√ß√µes (arestas):** Intera√ß√µes
-   **Pesos:** Intensidade/frequ√™ncia

## O que s√£o Redes Ecol√≥gicas?

**Tipos principais:**

1.  **Unipartidas:** üêí ‚Üî üêí ‚Üî üêí (mesmo tipo de organismo)

2.  **Bipartidas:** üå∫ ‚Üî üêù (dois tipos diferentes) üéØ

3.  **Multipartidas:** üå± ‚Üî üêõ ‚Üî üê¶ (tr√™s ou mais n√≠veis)

**Essa aula: Foco em BIPARTIDAS!**

## Tipos de Redes Bipartidas

::::: columns
::: {.column width="50%"}
**Mutual√≠sticas (+/+)**

-   Poliniza√ß√£o
-   Dispers√£o de sementes
-   Formiga-planta
-   Micorrizas

*Ambas esp√©cies se beneficiam*
:::

::: {.column width="50%"}
**Antagon√≠sticas (+/-)**

-   Herbivoria
-   Parasitismo
-   Pat√≥genos

*Uma se beneficia, outra prejudicada*
:::
:::::

**Nossa aula:** Foco em **FRUGIVORIA** (mutualismo)

Animais comem frutos ‚Üí dispersam sementes ‚Üí regenera√ß√£o florestal

## Por que Frugivoria?

**Import√¢ncia Ecol√≥gica:**

-   **Maioria das √°rvores tropicais** dependem de animais
-   Determina composi√ß√£o florestal futura
-   Conecta fragmentos florestais (corredores)
-   Mant√©m diversidade gen√©tica

## Por que Frugivoria?

**Import√¢ncia Econ√¥mica:**

-   Regenera√ß√£o de √°reas degradadas
-   Produ√ß√£o de frutos nativos
-   Ecoturismo (observa√ß√£o de aves)

**Amea√ßas:**

-   Perda de frug√≠voros grandes (defauna√ß√£o)
-   Fragmenta√ß√£o de habitats
-   Mudan√ßas clim√°ticas

## Contexto: Floresta com Arauc√°ria

::::: columns
::: {.column width="50%"}
**Floresta Ombr√≥fila Mista**

-   Maior extens√£o, Sul do Brasil (PR, SC, RS)
-   Altitude: 500-1.400m
-   Temperatura: 15-18¬∞C
-   **\<10% da √°rea original**

**Esp√©cie emblem√°tica:**

*Araucaria angustifolia*
:::

::: {.column width="50%"}
**Frug√≠voros importantes:**

-   Gralha-azul (*Cyanocorax caeruleus*)
-   Tucanos e papagaios
-   Macacos (bugio, macaco-prego)
-   Morcegos

**Amea√ßas:**

-   Fragmenta√ß√£o extrema
-   Perda de fauna
-   Necessidade urgente de restaura√ß√£o
:::
:::::

## Exerc√≠cio para hoje

**Pergunta Cient√≠fica:**

> "Como est√° estruturada a rede de frugivoria em um fragmento de Floresta com Arauc√°ria? Existem esp√©cies-chave para a regenera√ß√£o florestal?"

**Dados simulados para fins did√°ticos:**

-   24 esp√©cies de aves
-   13 esp√©cies de mam√≠feros
-   33 esp√©cies de √°rvores

# Parte 2: Conceitos Fundamentais {.center background-color="#2C5F2D"}

## Anatomia de uma Rede Bipartida

```{r echo=FALSE, fig.width=12, fig.height=8}
# Exemplo baseado em intera√ß√µes reais da FOM
exemplo <- matrix(c(25, 4, 6, 10,   # Gralha-azul - especialista em Araucaria
                    2, 15, 20, 12,  # Sabi√° - generalista, forte em Prunus
                    1, 12, 18, 8,   # Sanha√ßo - Prunus e Ocotea
                    12, 3, 4, 15),  # Papagaio - Araucaria e Ilex
                  nrow=4, byrow=TRUE,
                  dimnames=list(
                    c("Gralha-azul", "Sabi√°", "Sanha√ßo", "Papagaio"),
                    c("Araucaria", "Ocotea", "P. myrtifolia", "Ilex")
                  ))
plotweb(exemplo, 
        method="normal",
        text.rot=90,
        col.high = "#FF6B6B",
        col.low = "#4ECDC4",
        bor.col.high = "#C44569",
        bor.col.low = "#227C9D",
        y.lim=c(-1,3))
```

**Elementos:** Aves (topo) \| √Årvores (base) \| Linhas = intera√ß√µes

## Representa√ß√µes de Redes

**Tr√™s formas de visualizar a mesma rede:**

:::::: columns
::: {.column width="33%"}
**1. Matriz**

```{r echo=FALSE}
kable(exemplo, caption="Frequ√™ncia de visitas")
```
:::

::: {.column width="33%"}
**2. Grafo Bipartido**

(vimos no slide anterior)

-   Visualiza√ß√£o ecol√≥gica
-   F√°cil interpreta√ß√£o
-   Boa para apresenta√ß√µes
:::

::: {.column width="33%"}
**3. Lista de Arestas**

```         
Gralha-azul - Araucaria: 25
Gralha-azul - Ocotea: 4
Gralha-azul - P. myrtifolia: 6
Gralha-azul - Ilex: 10
...
```

-   Formato de banco de dados
:::
::::::

## Tipos de Esp√©cies na Rede: Generalistas üåü

Interagem com **muitas** esp√©cies \| Dieta ampla e flex√≠vel \| Ex: Sabi√°-laranjeira

::::: columns
::: {.column width="50%"}
**Caracter√≠sticas:**

-   **Alto grau (degree):** Visitam muitas plantas diferentes
-   **Alta for√ßa (strength):** Somando todas intera√ß√µes, s√£o muito ativos
-   **Baixa especializa√ß√£o:** N√£o dependem de uma √∫nica planta
:::

::: {.column width="50%"}
**Papel ecol√≥gico:**

-   **Conectividade da rede:** Ligam diferentes m√≥dulos, integrando a comunidade
-   **Redund√¢ncia funcional:** M√∫ltiplos dispersores por planta - "backup" ecol√≥gico
-   **Resili√™ncia do sistema:** Mant√™m dispers√£o mesmo com perda de outras esp√©cies
:::
:::::

## Tipos de Esp√©cies na Rede: Especialistas üéØ

Interagem com **poucas** esp√©cies \| Dieta restrita \| Ex: Gralha-azul e pinh√£o

::::: columns
::: {.column width="50%"}
**Caracter√≠sticas:**

-   **Baixo grau (degree):** Visitam poucas esp√©cies
-   **For√ßa vari√°vel (strength):** Podem fazer muitas visitas, mas s√≥ em uma planta
-   **Alta especializa√ß√£o:** Rela√ß√£o forte e exclusiva
:::

::: {.column width="50%"}
**Papel ecol√≥gico:**

-   **Vulner√°veis √† extin√ß√£o:** Se a planta desaparece, a ave tamb√©m
-   **Coevolu√ß√£o forte:** Adapta√ß√µes m√∫tuas (bico ‚Üî pinh√£o)
-   **Indicadores de qualidade:** Presen√ßa indica ecossistema preservado
:::
:::::

## Propriedades Emergentes em uma Rede

**Propriedades que surgem da rede como um todo:**

| Propriedade | Pergunta Ecol√≥gica | M√©trica (R) | Interpreta√ß√£o |
|-----------------|----------------------|-----------------|-----------------|
| **Conect√¢ncia** | Qu√£o conectada √© a rede? | `connectance` | 0-1: propor√ß√£o de intera√ß√µes poss√≠veis que ocorrem |
| **Aninhamento** | Especialistas visitam as mesmas plantas que generalistas? | `weighted NODF` | 0-100: quanto maior, mais aninhada |
| **Modularidade** | Existem sub-comunidades especializadas? | `modularity` | \>0.4: m√≥dulos bem definidos |
| **Especializa√ß√£o** | Qu√£o seletivas s√£o as intera√ß√µes? | `H2` | 0-1: (0=generalista, 1=especialista) |

**Exemplo de como calcular:** `networklevel(matriz, index = "connectance")`

## Conceito-Chave: Aninhamento

**O que √©?**

Padr√£o onde as intera√ß√µes dos especialistas s√£o **subconjuntos** das intera√ß√µes dos generalistas.

```{r echo=FALSE, fig.width=10, fig.height=8}
# Criar matriz aninhada
nested <- matrix(c(1,1,1,1,1,1,
                   0,1,1,1,1,1,
                   0,0,1,1,1,1,
                   0,0,0,1,1,1,
                   0,0,0,0,1,1,
                   0,0,0,0,0,1),
                 nrow=6, byrow=TRUE,
                 dimnames=list(
                   paste0("A", 1:6),
                   paste0("P", 1:6)
                 ))

visweb(nested, type="nested", text="none", square="b")
```

**Especialista A6** interage apenas com **P1** \| **Generalista A1** interage com **todas**

## Por que Aninhamento Importa?

**Rede ANINHADA** ‚úÖ

```{r echo=FALSE, fig.width=8, fig.height=6}
visweb(nested, type="nested", text="none", square="b")
```

**Caracter√≠sticas:**

-   **Perda de especialista = baixo impacto:** Outras esp√©cies compensam
-   **Generalistas sustentam rede:** Mant√™m conectividade mesmo com extin√ß√µes
-   **Maior resili√™ncia:** Rede tolera perturba√ß√µes

## Por que Aninhamento Importa?

**Rede MODULAR** ‚ö†Ô∏è

```{r echo=FALSE, fig.width=8, fig.height=6}
# Criar matriz modular
modular <- matrix(c(1,1,1,0,0,0,
                    1,1,1,0,0,0,
                    1,1,1,0,0,0,
                    0,0,0,1,1,1,
                    0,0,0,1,1,1,
                    0,0,0,1,1,1),
                  nrow=6, byrow=TRUE,
                  dimnames=list(
                    paste0("A", 1:6),
                    paste0("P", 1:6)
                  ))
visweb(modular, type="nested", text="none", square="b")
```

**Caracter√≠sticas:**

-   **Extin√ß√£o em cascata:** Perda de uma esp√©cie afeta todo o m√≥dulo
-   **M√≥dulos isolados:** Pouca redund√¢ncia funcional
-   **Menor resili√™ncia:** Rede vulner√°vel a perturba√ß√µes

## Conceito-Chave: Especializa√ß√£o (H2)

**O que √©?** √çndice que mede o **grau de seletividade** nas intera√ß√µes da rede.

$$H2 = \frac{H2'}{H2'_{max}}$$

**Interpreta√ß√£o pr√°tica:**

| Valor            | Significado             | Exemplo              |
|------------------|-------------------------|----------------------|
| **H2 ‚âà 0**       | Generalismo total       | Intera√ß√µes ao acaso  |
| **H2 = 0.3-0.6** | Especializa√ß√£o moderada | T√≠pico em frugivoria |
| **H2 ‚âà 1**       | Especializa√ß√£o perfeita | Rela√ß√µes exclusivas  |

**Base:** Entropia de Shannon

## Visualizando Especializa√ß√£o

```{r echo=FALSE, fig.width=12, fig.height=8}
# Criar tr√™s redes com diferentes n√≠veis de especializa√ß√£o
par(mfrow=c(1,3))

# Baixa especializa√ß√£o
low <- matrix(rpois(36, 5), nrow=6, ncol=6)
plotweb(low, method="normal")
title(main="Baixa Especializa√ß√£o\n(H2 ‚âà 0.2)")

# M√©dia especializa√ß√£o
medium <- nested * rpois(36, 8)
plotweb(medium, method="normal")
title(main="M√©dia Especializa√ß√£o\n(H2 ‚âà 0.5)")

# Alta especializa√ß√£o
high <- diag(6) * 10
plotweb(high, method="normal")
title(main="Alta Especializa√ß√£o\n(H2 ‚âà 1.0)")

par(mfrow=c(1,1))
```

## Conceitos em N√≠vel de Esp√©cie

**M√©tricas para avaliar o papel de cada esp√©cie na rede:**

| M√©trica | O que mede? | Nome no R | Interpreta√ß√£o |
|-----------------|------------------|-----------------|---------------------|
| **Grau** | Quantos parceiros? | `degree` | N√∫mero de esp√©cies com que interage |
| **For√ßa** | Qu√£o ativa? | `species strength` | Soma total de intera√ß√µes |
| **PDI** | Qu√£o seletiva? | `PDI` | 0=generalista, 1=especialista |
| **Centralidade** | Qu√£o importante estruturalmente? | `betweenness` | Papel como "ponte" na rede |

**Como calcular:** `specieslevel(matriz, index = "degree")`

**Exemplo pr√°tico:** Sabi√° tem alto grau (visita v√°rias plantas) + alta for√ßa (muitas visitas) = esp√©cie-chave por causa da por CONECTIVIDADE!

## Conceito-Chave: Centralidade

**Centralidade** = import√¢ncia como **"ponte"** entre diferentes partes da rede

::::: columns
::: {.column width="50%"}
**ALTA centralidade** üåâ

-   Liga grupos diferentes
-   Caminho obrigat√≥rio
-   **Perda ‚Üí rede fragmenta**

**Ex:** Ave ligando Lauraceae (dossel) ‚Üî Myrtaceae (sub-bosque)
:::

::: {.column width="50%"}
**BAIXA centralidade** üîó

-   Redundante
-   N√£o √© ponte essencial
-   **Perda ‚Üí outras compensam**

**Ex:** Sabi√° visitando Myrtaceae com outras 5 esp√©cies
:::
:::::

**Conserva√ß√£o:** Priorizar esp√©cies centrais!

## O que "Circula" via Centralidade?

**Esp√©cies centrais facilitam fluxos ecol√≥gicos:**

| Tipo de Fluxo | Exemplo em Lages |
|---------------------------------|---------------------------------------|
| **Subs√≠dio energ√©tico** | *Sp. 1* (inverno) + *Sp. 2* (primavera) + *Sp. 3* (ver√£o) ‚Üí recursos complementares mant√™m Sabi√° ativo ano todo |
| **Popula√ß√µes vi√°veis** | Fenologia complementar de Aquifoliaceae + Lauraceae + Myrtaceae sustenta popula√ß√£o de dispersores generalistas |
| **Cascatas** | Defauna√ß√£o de generalistas ‚Üí falha regenera√ß√£o simult√¢nea de m√∫ltiplas fam√≠lias (Lauraceae, Myrtaceae, Rosaceae) |
| **Prop√°gulos** | Gralha-azul move pinh√£o entre cap√µes distantes |
| **Resili√™ncia** | Falha reprodutiva de algumas esp√©cies compensada por outras |

**Centralidade = integra√ß√£o funcional da floresta!**

## Esp√©cies-Chave para Conserva√ß√£o

**Como identificar esp√©cies priorit√°rias?**

| Tipo | Caracter√≠sticas | M√©tricas | Papel Ecol√≥gico | Exemplo |
|--------------|----------------|--------------|----------------|--------------|
| **Generalistas Ativos** | Muitos parceiros + muitas intera√ß√µes | Alto grau + alta for√ßa | Mant√™m rede conectada | Sabi√°-laranjeira |
| **Especialistas Fortes** | Poucos parceiros + intera√ß√µes intensas | Baixo grau + alta for√ßa | Vulner√°veis mas √∫nicos | Gralha-azul ‚Üî Araucaria |
| **Conectores** | Ligam diferentes m√≥dulos | Alta centralidade (betweenness) | Integram sub-redes | Ave ligando dossel-solo |

**Estrat√©gia:** Priorizar todos os 3 tipos - cada um tem fun√ß√£o √∫nica!

## Resumo dos Conceitos üìù

| Conceito        | N√≠vel   | O que mede                | Valores |
|-----------------|---------|---------------------------|---------|
| **Conect√¢ncia** | Rede    | Densidade de conex√µes     | 0-1     |
| **H2**          | Rede    | Especializa√ß√£o geral      | 0-1     |
| **Nestedness**  | Rede    | Padr√£o de subconjuntos    | 0-100   |
| **Grau**        | Esp√©cie | N√∫mero de parceiros       | 1-N     |
| **PDI**         | Esp√©cie | Especializa√ß√£o individual | 0-1     |
| **For√ßa**       | Esp√©cie | Total de intera√ß√µes       | \>0     |

**Pr√≥ximo:** Vamos criar nossos dados e calcular tudo isso! üí™

# Parte 3: Criando Dados Did√°ticos {.center background-color="#2C5F2D"}

**Dura√ß√£o: 20 minutos**

## Nosso Dataset Did√°tico: Floresta com Arauc√°ria

**Vamos simular uma rede de frugivoria!**

**Cen√°rio:**

-   Fragmento florestal em Lages-SC
-   Altitude: 920m
-   M√©todo: observa√ß√£o focal de √°rvores frutificando

**Comunidade:**

-   **37 esp√©cies de frug√≠voros** (24 aves + 13 mam√≠feros)
-   **33 esp√©cies de √°rvores** produtoras de frutos
-   Dados de frequ√™ncia de visita√ß√£o

## Passo 1: Criar Lista de Esp√©cies

```{r}
# ============================================
# CRIAR COMUNIDADE DE FRUG√çVOROS
# ============================================

# AVES (24 esp√©cies)
aves <- c(
  # Grandes frug√≠voros
  "Ramphastos dicolorus",      # Tucano-de-bico-verde
  "Amazona vinacea",           # Papagaio-de-peito-roxo
  "Amazona pretrei",           # Papagaio-char√£o
  "Cyanocorax caeruleus",      # Gralha-azul
  
  # M√©dios frug√≠voros
  "Turdus rufiventris",        # Sabi√°-laranjeira
  "Turdus albicollis",         # Sabi√°-coleira
  "Turdus amaurochalinus",     # Sabi√°-poca
  "Euphonia chlorotica",       # Fim-fim
  "Euphonia cyanocephala",     # Gaturamo-rei
  "Tangara sayaca",            # Sanha√ßo-cinzento
  "Pipraeidea melanonota",     # Sa√≠ra-vi√∫va
  "Dacnis cayana",             # Sa√≠-azul
  
  # Pequenos frug√≠voros
  "Elaenia flavogaster",       # Guaracava
  "Myiodynastes maculatus",    # Bem-te-vi-rajado
  "Pitangus sulphuratus",      # Bem-te-vi
  "Tyrannus melancholicus",    # Suiriri
  
  # Beija-flores (especialistas)
  "Thalurania glaucopis",      # Beija-flor-de-fronte-violeta
  "Leucochloris albicollis",   # Beija-flor-de-papo-branco
  "Stephanoxis lalandi",       # Beija-flor-de-topete
  
  # Outros
  "Pyroderus scutatus",        # Pav√≥
  "Procnias nudicollis",       # Araponga
  "Selenidera maculirostris",  # Ara√ßari-poca
  "Penelope obscura",          # Jacua√ßu
  "Columba livia"              # Pomba-dom√©stica
)

# MAM√çFEROS (13 esp√©cies)
mamiferos <- c(
  # Primatas
  "Alouatta guariba",          # Bugio-ruivo
  "Sapajus nigritus",          # Macaco-prego
  
  # Morcegos frug√≠voros
  "Artibeus lituratus",        # Morcego-grande-de-listra
  "Artibeus fimbriatus",       # Morcego-das-frutas-grande
  "Sturnira lilium",           # Morcego-de-ombros-amarelos
  "Carollia perspicillata",    # Morcego-cauda-curta
  "Platyrrhinus lineatus",     # Morcego-de-listra-branca
  
  # Roedores
  "Dasyprocta azarae",         # Cutia

  # Marsupiais
  "Didelphis albiventris",     # Gamb√°-de-orelha-branca
  
  # Carn√≠voros
  "Nasua nasua",               # Quati
  "Procyon cancrivorus",       # M√£o-pelada
  "Eira barbara",              # Irara
  "Leopardus wiedii"           # Gato-maracaj√°
)

# Juntar todos
frugivoros <- c(aves, mamiferos)

cat("Total de frug√≠voros:", length(frugivoros), "\n")
cat("- Aves:", length(aves), "\n")
cat("- Mam√≠feros:", length(mamiferos), "\n")
```

## Passo 2: Criar Lista de √Årvores

```{r}
# ============================================
# CRIAR COMUNIDADE DE √ÅRVORES
# ============================================

arvores <- c(
  # Myrtaceae (frutos carnosos, muito visitados)
  "Eugenia uniflora",          # Pitangueira
  "Eugenia pyriformis",        # Uvaia
  "Campomanesia xanthocarpa",  # Guabiroba
  "Myrcia splendens",          # Cambu√≠-vermelho
  "Myrcianthes pungens",       # Guabiju
  "Myrcia palustris",          # Cambu√≠
  
  # Lauraceae (frutos importantes para aves grandes)
  "Ocotea pulchella",          # Canela-lageana
  "Nectandra megapotamica",    # Canela-imbuia
  "Ocotea puberula",           # Canela-guaic√°
  
  # Araucariaceae (pinh√£o - recurso sazonal importante)
  "Araucaria angustifolia",    # Arauc√°ria
  
  # Aquifoliaceae
  "Ilex paraguariensis",       # Erva-mate
  "Ilex microdonta",           # Ca√∫na-mi√∫da
  "Ilex theezans",             # Ca√∫na
  
  # Rosaceae
  "Prunus myrtifolia",         # Pessegueiro-bravo
  
  # Sapindaceae
  "Cupania vernalis",          # Camboat√°
  "Allophylus edulis",         # Chal-chal
  
  # Solanaceae (pioneiras, muito produtivas)
  "Solanum pseudoquina",       # Jo√°
  "Solanum sanctaecatharinae", # Jo√°-manso
  "Solanum variabile",         # Jo√°-de-√°rvore
  
  # Salicaceae
  "Casearia decandra",         # Gua√ßatunga
  "Xylosma ciliatifolia",      # Sucar√°
  
  # Celastraceae
  "Maytenus ilicifolia",       # Espinheira-santa
  "Schaefferia argentinensis", # Sombreiro
  
  # Outras fam√≠lias importantes
  "Schinus terebinthifolia",   # Aroeira-vermelha (Anacardiaceae)
  "Lithraea brasiliensis",     # bugreiro (Anacardiaceae)
  "Zanthoxylum rhoifolium",    # Mamica-de-cadela (Rutaceae)
  "Myrsine coriacea",          # Capororoca (Primulaceae)
  "Myrsine umbellata",         # Capororoquinha (Primulaceae)
  "Drimys brasiliensis",       # Casca-d'anta (Winteraceae)
  "Roupala montana",      # Carvalho-brasileiro (Proteaceae)
  "Sebastiania commersoniana", # Branquilho (Euphorbiaceae)
  "Matayba elaeagnoides",      # Camboat√°-branco (Sapindaceae)
  "Styrax leprosus"            # Carne-de-vaca (Styracaceae)
)

cat("Total de √°rvores:", length(arvores), "\n")
```

## Passo 3: Criar Matriz de Intera√ß√µes

```{r}
# ============================================
# CRIAR MATRIZ DE INTERA√á√ïES REALISTA
# ============================================

# Dimens√µes
n_frug <- length(frugivoros)
n_arv <- length(arvores)

# Criar matriz vazia
matriz_frugivoria <- matrix(0,
                            nrow = n_frug,
                            ncol = n_arv,
                            dimnames = list(frugivoros, arvores))

# ============================================
# ESTRAT√âGIA DE PREENCHIMENTO REALISTA
# ============================================

# 1. GENERALISTAS (10% das esp√©cies) - muitas intera√ß√µes
n_generalistas <- round(n_frug * 0.10)
generalistas_idx <- 1:n_generalistas

for(i in generalistas_idx) {
  # Generalistas interagem com 40-60% das plantas
  n_parceiros <- sample(round(n_arv * 0.4):round(n_arv * 0.6), 1)
  parceiros <- sample(1:n_arv, n_parceiros)
  
  # Frequ√™ncia de visitas: alta
  matriz_frugivoria[i, parceiros] <- rpois(n_parceiros, lambda = 8)
}

# 2. MODERADOS (60% das esp√©cies) - intera√ß√µes m√©dias
moderados_idx <- (n_generalistas + 1):round(n_frug * 0.70)

for(i in moderados_idx) {
  # Moderados interagem com 15-35% das plantas
  n_parceiros <- sample(round(n_arv * 0.15):round(n_arv * 0.35), 1)
  parceiros <- sample(1:n_arv, n_parceiros)
  
  # Frequ√™ncia de visitas: m√©dia
  matriz_frugivoria[i, parceiros] <- rpois(n_parceiros, lambda = 4)
}

# 3. ESPECIALISTAS (30% das esp√©cies) - poucas intera√ß√µes
especialistas_idx <- (round(n_frug * 0.70) + 1):n_frug

for(i in especialistas_idx) {
  # Especialistas interagem com 5-15% das plantas
  n_parceiros <- sample(round(n_arv * 0.05):round(n_arv * 0.15), 1)
  n_parceiros <- max(n_parceiros, 1)  # Pelo menos 1 parceiro
  parceiros <- sample(1:n_arv, n_parceiros)
  
  # Frequ√™ncia de visitas: vari√°vel (alguns muito especializados)
  if(runif(1) > 0.7) {
    # 30% dos especialistas t√™m uma intera√ß√£o muito forte
    matriz_frugivoria[i, parceiros] <- c(rpois(1, lambda = 15),
                                         rpois(n_parceiros-1, lambda = 2))
  } else {
    matriz_frugivoria[i, parceiros] <- rpois(n_parceiros, lambda = 3)
  }
}

# ============================================
# AJUSTES ECOL√ìGICOS REALISTAS
# ============================================

# Arauc√°ria: especialistas importantes (Gralha-azul, papagaios, cutia)
araucaria_idx <- which(colnames(matriz_frugivoria) == "Araucaria angustifolia")
gralha_idx <- which(rownames(matriz_frugivoria) == "Cyanocorax caeruleus")
cutia_idx <- which(rownames(matriz_frugivoria) == "Dasyprocta azarae")

matriz_frugivoria[gralha_idx, araucaria_idx] <- 45  # Intera√ß√£o muito forte
matriz_frugivoria[cutia_idx, araucaria_idx] <- 38

# Myrtaceae: muito visitadas por tucanos e sabi√°s
myrtaceae_idx <- grep("Eugenia|Psidium|Campomanesia|Myrcia", 
                     colnames(matriz_frugivoria))
tucanos_idx <- grep("Ramphastos", rownames(matriz_frugivoria))
sabias_idx <- grep("Turdus", rownames(matriz_frugivoria))

for(i in tucanos_idx) {
  parceiros_myr <- sample(myrtaceae_idx, 
                         min(4, length(myrtaceae_idx)))
  matriz_frugivoria[i, parceiros_myr] <- 
    matriz_frugivoria[i, parceiros_myr] + rpois(length(parceiros_myr), 5)
}

# Remover alguns zeros para criar rede mais realista
# (algumas esp√©cies raras sem intera√ß√µes observadas)
especies_raras <- sample(1:n_frug, round(n_frug * 0.05))
for(i in especies_raras) {
  if(sum(matriz_frugivoria[i, ]) < 5) {
    matriz_frugivoria[i, ] <- 0
  }
}

# Remover esp√©cies sem nenhuma intera√ß√£o
matriz_frugivoria <- matriz_frugivoria[rowSums(matriz_frugivoria) > 0, ]
matriz_frugivoria <- matriz_frugivoria[, colSums(matriz_frugivoria) > 0]

# Estat√≠sticas da rede
cat("\n=== ESTAT√çSTICAS DA REDE CRIADA ===\n")
cat("Dimens√µes finais:", nrow(matriz_frugivoria), "√ó", 
    ncol(matriz_frugivoria), "\n")
cat("Total de intera√ß√µes:", sum(matriz_frugivoria > 0), "\n")
cat("Total de visitas:", sum(matriz_frugivoria), "\n")
cat("Conect√¢ncia:", round(sum(matriz_frugivoria > 0) / 
    (nrow(matriz_frugivoria) * ncol(matriz_frugivoria)), 3), "\n")
```

## Visualizar Nossos Dados Simulados

```{r fig.width=12, fig.height=8}
# Visualizar matriz
visweb(matriz_frugivoria,
       type = "nested",
       labsize = 0.8,
       text = "none",
       square = "b")
title(main = "Rede de Frugivoria - Floresta com Arauc√°ria\n(Dados Did√°ticos)")
```

## Primeiras Impress√µes da Rede üëÄ

```{r}
# Quantas esp√©cies de frug√≠voros?
nrow(matriz_frugivoria)

# Quantas esp√©cies de √°rvores?
ncol(matriz_frugivoria)

# Quantas intera√ß√µes diferentes foram observadas?
sum(matriz_frugivoria > 0)

# Qual o total de visitas registradas?
sum(matriz_frugivoria)
```

## Distribui√ß√£o de Intera√ß√µes

```{r}
# Distribui√ß√£o de parceiros por frug√≠voro (quantas plantas cada ave/mam√≠fero visitou?)
summary(rowSums(matriz_frugivoria > 0))

# Distribui√ß√£o de visitantes por √°rvore (quantos frug√≠voros visitaram cada planta?)
summary(colSums(matriz_frugivoria > 0))
```

# Parte 4: An√°lises de Rede {.center background-color="#2C5F2D"}

**Dura√ß√£o: 45 minutos**

## M√©tricas de N√≠vel de Rede

**Calcular propriedades da rede com `networklevel()`:**

```{r}
# Calcular todas as m√©tricas de uma vez
metricas_rede <- networklevel(
  matriz_frugivoria,
  index = c("connectance", "weighted connectance", "H2",
            "weighted NODF", "links per species")
)
```

## Conectividade da Rede

```{r}
# Qu√£o conectada √© a rede? (propor√ß√£o de links poss√≠veis que existem)
metricas_rede["connectance"]

# Conect√¢ncia ponderada (considerando intensidade das intera√ß√µes)
metricas_rede["weighted connectance"]

# M√©dia de parceiros por esp√©cie
metricas_rede["links per species"]
```

## Especializa√ß√£o e Aninhamento

```{r}
# H2: Especializa√ß√£o da rede (0=generalista, 1=especialista)
metricas_rede["H2"]

# NODF: Aninhamento (0-100, quanto maior mais aninhada)
metricas_rede["weighted NODF"]
```

## Interpretando H2

```{r}
h2_valor <- metricas_rede["H2"]

cat("=== INTERPRETA√á√ÉO DO H2 ===\n\n")
cat("Valor observado:", round(h2_valor, 3), "\n\n")

if(h2_valor < 0.3) {
  interpretacao <- "BAIXA especializa√ß√£o\n  ‚Üí Rede com intera√ß√µes generalistas\n  ‚Üí Esp√©cies com dietas amplas\n  ‚Üí Baixa seletividade"
} else if(h2_valor < 0.6) {
  interpretacao <- "MODERADA especializa√ß√£o\n  ‚Üí Mix de generalistas e especialistas\n  ‚Üí Padr√£o comum em redes mutual√≠sticas\n  ‚Üí Rede com estrutura intermedi√°ria"
} else {
  interpretacao <- "ALTA especializa√ß√£o\n  ‚Üí Intera√ß√µes muito seletivas\n  ‚Üí Forte potencial para coevolu√ß√£o\n  ‚Üí Rede altamente estruturada"
}

cat(interpretacao, "\n\n")


```

## Interpretando Aninhamento

```{r}
# Valor de NODF observado
nodf_valor <- metricas_rede["weighted NODF"]
nodf_valor

# Classifica√ß√£o autom√°tica
if(nodf_valor < 20) {
  cat("BAIXO aninhamento ‚Üí Estrutura mais modular")
} else if(nodf_valor < 40) {
  cat("MODERADO aninhamento ‚Üí Hierarquia parcial")
} else {
  cat("ALTO aninhamento ‚Üí Hierarquia clara")
}
```

## Implica√ß√µes do Aninhamento para Conserva√ß√£o

```{r}
# O que significa para conserva√ß√£o?
if(nodf_valor > 30) {
  cat("‚úì Rede ANINHADA\n\n")
  cat("  ‚Ä¢ Perda de especialistas tem impacto menor\n")
  cat("  ‚Ä¢ Generalistas mant√™m conectividade\n")
  cat("  ‚Ä¢ Rede relativamente est√°vel\n")
} else {
  cat("‚ö† Rede POUCO ANINHADA - Aten√ß√£o!\n\n")
  cat("  ‚Ä¢ Rede mais vulner√°vel\n")
  cat("  ‚Ä¢ Extin√ß√µes podem causar efeitos em cascata\n")
}
```

## Visualiza√ß√£o: Rede Completa üï∏Ô∏è

```{r fig.width=14, fig.height=9}
# Criar visualiza√ß√£o mais elaborada
plotweb(matriz_frugivoria,
        method = "normal",
        text.rot = 90,
        col.interaction = "grey80",
        bor.col.interaction = "grey60",
        col.high = "#FF6B6B",      # Frug√≠voros em vermelho
        col.low = "#4ECDC4",       # √Årvores em azul
        bor.col.high = "#C44569",
        bor.col.low = "#227C9D",
        labsize = 0.7,
        y.lim = c(-1, 3))
title(main = paste0("Rede de Frugivoria - Floresta com Arauc√°ria\n",
                   "H2 = ", round(h2_valor, 3),
                   " | NODF = ", round(nodf_valor, 1),
                   " | Conect√¢ncia = ",
                   round(metricas_rede["weighted connectance"], 3)))
```

## M√©tricas de N√≠vel de Esp√©cie

**Calcular m√©tricas para cada esp√©cie:**

```{r}
# Calcular com specieslevel()
metricas_especies <- specieslevel(
  matriz_frugivoria,
  index = c("degree", "species strength", "PDI")
)
```

## Separando Frug√≠voros e √Årvores

```{r}
# Separar os dois n√≠veis tr√≥ficos
# higher level = parte de cima do grafo (√°rvores)
# lower level = parte de baixo do grafo (frug√≠voros)
arv_metrics <- as.data.frame(metricas_especies$`higher level`)
frug_metrics <- as.data.frame(metricas_especies$`lower level`)

# Adicionar coluna com nomes das esp√©cies
frug_metrics$especie <- rownames(frug_metrics)
arv_metrics$especie <- rownames(arv_metrics)

# Quantas esp√©cies foram analisadas?
nrow(frug_metrics)  # Frug√≠voros
nrow(arv_metrics)   # √Årvores
```

## Top 10 Frug√≠voros Mais Importantes ü¶ú

```{r}
# Ordenar por for√ßa (strength)
top_frug <- frug_metrics %>%
  arrange(desc(species.strength)) %>%
  head(10) %>%
  select(especie, degree, species.strength, PDI)

# Formatar tabela
kable(top_frug, 
      digits = 3,
      col.names = c("Esp√©cie", "Grau", "For√ßa", "PDI"),
      caption = "Top 10 Frug√≠voros por For√ßa de Intera√ß√£o")
```

**Interpreta√ß√£o:**

-   **For√ßa alta** = muitas visitas totais (dispersor importante)
-   **Grau alto** = muitas esp√©cies visitadas (generalista)
-   **PDI baixo** = generalista \| **PDI alto** = especialista

## Top 10 √Årvores Mais Visitadas

```{r}
# Ordenar por for√ßa (strength)
top_arv <- arv_metrics %>%
  arrange(desc(species.strength)) %>%
  head(10) %>%
  select(especie, degree, species.strength, PDI)

# Formatar tabela
kable(top_arv, 
      digits = 3,
      col.names = c("Esp√©cie", "Grau", "For√ßa", "PDI"),
      caption = "Top 10 √Årvores por Frequ√™ncia de Visita√ß√£o")
```

**Interpreta√ß√£o:**

-   **For√ßa alta** = recurso muito usado
-   **Grau alto** = visitada por muitos frug√≠voros
-   **PDI baixo** = generalista \| **PDI alto** = especialista

## Identificando Esp√©cies-Chave

```{r fig.width=12, fig.height=8}
# Classificar frug√≠voros
frug_metrics <- frug_metrics %>%
  mutate(
    tipo = case_when(
      degree >= quantile(degree, 0.75) & 
        species.strength >= quantile(species.strength, 0.75) ~ "Super-generalista",
      degree >= quantile(degree, 0.75) ~ "Generalista",
      species.strength >= quantile(species.strength, 0.75) ~ "Especialista forte",
      TRUE ~ "Perif√©rico"
    )
  )

# Plotar
ggplot(frug_metrics, aes(x = degree, y = species.strength, 
                        color = tipo, size = PDI)) +
  geom_point(alpha = 0.7) +
  scale_color_manual(values = c(
    "Super-generalista" = "#FF6B6B",
    "Generalista" = "#4ECDC4",
    "Especialista forte" = "#FFE66D",
    "Perif√©rico" = "#95E1D3"
  )) +
  labs(
    title = "Identifica√ß√£o de Esp√©cies-Chave de Frug√≠voros",
    subtitle = "Baseado em Grau e For√ßa de Intera√ß√£o",
    x = "Grau (n√∫mero de parceiros)",
    y = "For√ßa (total de intera√ß√µes)",
    color = "Tipo funcional",
    size = "Especializa√ß√£o (PDI)"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "right",
    plot.title = element_text(hjust = 0.5, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5)
  )
```

## Distribui√ß√£o de Especializa√ß√£o (PDI)

```{r fig.width=12, fig.height=8}
par(mfrow = c(1, 2))

# Histograma frug√≠voros
hist(frug_metrics$PDI,
     breaks = 15,
     col = "#FF6B6B",
     border = "white",
     main = "Especializa√ß√£o dos Frug√≠voros",
     xlab = "PDI (0 = generalista, 1 = especialista)",
     ylab = "Frequ√™ncia",
     xlim = c(0, 1))
abline(v = mean(frug_metrics$PDI), col = "darkred", lwd = 2, lty = 2)
legend("topright", legend = paste("M√©dia =", round(mean(frug_metrics$PDI), 2)),
       col = "darkred", lty = 2, lwd = 2)

# Histograma √°rvores
hist(arv_metrics$PDI,
     breaks = 15,
     col = "#4ECDC4",
     border = "white",
     main = "Especializa√ß√£o das √Årvores",
     xlab = "PDI (0 = generalista, 1 = especialista)",
     ylab = "Frequ√™ncia",
     xlim = c(0, 1))
abline(v = mean(arv_metrics$PDI), col = "darkblue", lwd = 2, lty = 2)
legend("topright", legend = paste("M√©dia =", round(mean(arv_metrics$PDI), 2)),
       col = "darkblue", lty = 2, lwd = 2)

par(mfrow = c(1, 1))
```

## Compara√ß√£o: Frug√≠voros vs √Årvores

```{r}
# Os dois grupos t√™m especializa√ß√£o diferente?
teste_pdi <- t.test(frug_metrics$PDI, arv_metrics$PDI)
teste_pdi
```

# Parte 5: Modelos Nulos {.center background-color="#2C5F2D"}

## Por que Modelos Nulos?

**Pergunta:** O H2 que encontramos √© significativo ou apenas acaso?

**Solu√ß√£o:** Comparar com o esperado ao acaso (modelo nulo)

**Como funciona:**

1.  Aleatoriza matriz 1000 vezes
2.  Calcula H2 para cada matriz aleat√≥ria
3.  Compara observado vs. distribui√ß√£o nula
4.  **p \< 0.05** = padr√£o REAL (n√£o aleat√≥rio)

## Teste Nulo para H2

```{r}
# Executar teste nulo (pode demorar ~1 min)
set.seed(123)
null_test_h2 <- null.t.test(
  matriz_frugivoria,
  index = "H2",
  nrep = 100,
  N = 100  # Reduzir para 100 se demorar muito
)

# Resultado direto
null_test_h2
```

## Visualiza√ß√£o do Modelo Nulo

```{r fig.width=12, fig.height=8}
# Gerar distribui√ß√£o nula
set.seed(456)
nulls <- nullmodel(matriz_frugivoria, N = 100, method = 1)
null_H2 <- sapply(nulls, function(x) networklevel(x, index = "H2"))
null_H2 <- null_H2[is.finite(null_H2)]

# Valor observado
h2_obs <- as.numeric(null_test_h2["observed"])

# Histograma
hist(null_H2, breaks = 40, col = "lightblue", border = "white",
     main = "H2: Observado vs. Esperado ao Acaso",
     xlab = "H2 (Especializa√ß√£o)", ylab = "Frequ√™ncia")
abline(v = h2_obs, col = "red", lwd = 3, lty = 2)
abline(v = mean(null_H2), col = "blue", lwd = 2, lty = 3)
legend("topright",
       legend = c("Observado", "M√©dia Nula"),
       col = c("red", "blue"), lty = c(2, 3), lwd = c(3, 2))
```

# Parte 6: Aplica√ß√µes Pr√°ticas {.center background-color="#2C5F2D"}

**Dura√ß√£o: 25 minutos**

## Aplica√ß√£o 1: Prioriza√ß√£o para Conserva√ß√£o üõ°Ô∏è

::: {.callout-important appearance="simple"}
## üß† Reflex√£o Cr√≠tica
**"Prioridade" √© subjetivo!** Este √≠ndice favorece a **estrutura da rede** (Generalistas). Outros objetivos podem focar em esp√©cies **raras** ou **insubstitu√≠veis**.
:::

**Como identificar esp√©cies-chave para conserva√ß√£o?**

::::: columns
::: {.column width="50%"}
**Crit√©rios:**

-   **Grau**: Quantas plantas visitam
-   **For√ßa**: Intensidade de intera√ß√µes
-   **√çndice**: Combina√ß√£o ponderada
:::

::: {.column width="50%"}
**Categorias:**

-   Cr√≠tico: ‚â• 0.75
-   Alto: 0.50-0.75
-   M√©dio: 0.25-0.50
-   Baixo: \< 0.25
:::
:::::



## Aplica√ß√£o 1: C√°lculo do √çndice üßÆ

```{r}
# Criar √≠ndice de prioridade
frug_prioridade <- frug_metrics %>%
  mutate(
    degree_norm = (degree - min(degree)) / (max(degree) - min(degree)),
    strength_norm = (species.strength - min(species.strength)) /
                    (max(species.strength) - min(species.strength)),
    prioridade = (degree_norm * 0.4) + (strength_norm * 0.6),
    categoria = case_when(
      prioridade >= 0.75 ~ "Cr√≠tico",
      prioridade >= 0.50 ~ "Alto",
      prioridade >= 0.25 ~ "M√©dio",
      TRUE ~ "Baixo"
    )
  ) %>%
  arrange(desc(prioridade))

```

## Aplica√ß√£o 1: Resultados üìä

```{r}
# Top 10 priorit√°rios
frug_prioridade %>%
  head(10) %>%
  select(especie, degree, species.strength, prioridade, categoria) %>%
  kable(digits = 3, caption = "Esp√©cies Priorit√°rias para Conserva√ß√£o")
```



## Aplica√ß√£o 2: Planejamento de Restaura√ß√£o üå±

**Quais esp√©cies arb√≥reas plantar primeiro?**

**Crit√©rio:** √Årvores visitadas por muitos frug√≠voros diferentes

## Aplica√ß√£o 2: C√°lculo do √çndice üßÆ

```{r}
# Criar √≠ndice de restaura√ß√£o
arv_restauracao <- arv_metrics %>%
  mutate(
    degree_norm = (degree - min(degree)) / (max(degree) - min(degree)),
    strength_norm = (species.strength - min(species.strength)) /
                    (max(species.strength) - min(species.strength)),
    # Priorizamos diversidade de visitantes (grau)
    indice_restauracao = (degree_norm * 0.7) + (strength_norm * 0.3),
    categoria = case_when(
      indice_restauracao >= 0.75 ~ "Priorit√°ria",
      indice_restauracao >= 0.50 ~ "Importante",
      indice_restauracao >= 0.25 ~ "Complementar",
      TRUE ~ "Opcional"
    )
  ) %>%
  arrange(desc(indice_restauracao))
```

## Aplica√ß√£o 2: Resultados üìä

```{r}
# Top 12 para restaura√ß√£o
arv_restauracao %>%
  head(12) %>%
  select(especie, degree, indice_restauracao, categoria) %>%
  kable(digits = 3, caption = "Esp√©cies Priorit√°rias para Restaura√ß√£o")
```

## Reflex√£o: Pontos de Aten√ß√£o üß†

::: {.callout-warning appearance="simple"}
## 1. O Gargalo Temporal (Fenologia) ‚è≥
Este √≠ndice seleciona esp√©cies que atraem muitos animais, mas **ignora quando elas frutificam**.
**Risco:** Se todas as priorit√°rias frutificarem no ver√£o, a fauna ficar√° sem alimento no inverno.
:::

::: {.callout-tip appearance="simple"}
## 2. Esp√©cies Funcionais Espec√≠ficas üê¶
Algumas √°rvores t√™m baixo grau (poucos visitantes), mas s√£o essenciais para **dispersores especialistas** (ex: Tucanos e Jacutingas) que carregam sementes grandes de √°rvores cl√≠max.
:::

## Fases de Restaura√ß√£o

**Sequ√™ncia temporal de plantio:**

1.  **Priorit√°rias** (anos 1-2)
    -   Atraem maior diversidade de dispersores
    -   Iniciam cascata de regenera√ß√£o
2.  **Importantes** (anos 3-5)
    -   Complementam recursos ao longo do ano
    -   Suportam esp√©cies especialistas
3.  **Complementares** (anos 5+)
    -   Preenchem nichos vazios
    -   Completam a estrutura da rede

## Aplica√ß√£o 3: Simula√ß√£o de Extin√ß√£o ‚ö†Ô∏è

**O que acontece se perdermos uma esp√©cie-chave?**

## Aplica√ß√£o 3: C√≥digo da Simula√ß√£o üíª

```{r}
# Fun√ß√£o simples de simula√ß√£o
simular_extincao <- function(matriz, especie) {
  if(!especie %in% rownames(matriz)) return(NULL)

  # Remover esp√©cie e plantas √≥rf√£s
  matriz_nova <- matriz[rownames(matriz) != especie, ]
  matriz_nova <- matriz_nova[, colSums(matriz_nova) > 0]

  # Calcular impacto
  list(
    plantas_perdidas = ncol(matriz) - ncol(matriz_nova),
    metricas = networklevel(matriz_nova, index = c("H2", "weighted NODF"))
  )
}
```

**Conceito:** Remover esp√©cie e recalcular m√©tricas da rede

## Aplica√ß√£o 3: Resultado da Simula√ß√£o üìâ

```{r}
# Simular extin√ß√£o de esp√©cie priorit√°ria
metricas_orig <- networklevel(matriz_frugivoria, index = c("H2", "weighted NODF"))
especie_teste <- frug_prioridade$especie[
  frug_prioridade$especie %in% rownames(matriz_frugivoria)
][1]
resultado <- simular_extincao(matriz_frugivoria, especie_teste)

# Impacto
cat("Esp√©cie:", especie_teste, "\n")
cat("Plantas perdidas:", resultado$plantas_perdidas, "\n\n")
cat("H2:", round(metricas_orig["H2"], 3), "‚Üí", round(resultado$metricas["H2"], 3), "\n")
cat("NODF:", round(metricas_orig["weighted NODF"], 1), "‚Üí",
    round(resultado$metricas["weighted NODF"], 1), "\n")
```

## Reflex√£o: Limita√ß√µes da Simula√ß√£o üß†

::: {.callout-warning appearance="simple"}
## 1. O Modelo √© Est√°tico (Pior Cen√°rio) üõë
Esta simula√ß√£o assume que se o parceiro some, a planta morre imediatamente.
**Realidade:** Na natureza, existe o **Recabeamento (Rewiring)**. Outros animais podem mudar de comportamento e passar a consumir os frutos da planta "√≥rf√£", amortecendo o impacto.
:::

::: {.callout-important appearance="simple"}
## 2. Extin√ß√£o Funcional vs. Num√©rica üìâ
O impacto ecol√≥gico come√ßa muito antes da esp√©cie desaparecer totalmente. Quando a popula√ß√£o cai abaixo de um certo n√≠vel, ela j√° deixa de cumprir sua fun√ß√£o na rede (dispers√£o efetiva).
:::


## Aplica√ß√£o 4: Defauna√ß√£o e Fragmenta√ß√£o üó∫Ô∏è

**Cen√°rio:** Fragmentos florestais perdem grandes frug√≠voros (mam√≠feros s√£o mais vulner√°veis)

## Aplica√ß√£o 4: C√≥digo da Simula√ß√£o üíª

```{r}
# Simular defauna√ß√£o: mam√≠feros desaparecem primeiro
# (mais sens√≠veis √† fragmenta√ß√£o, ca√ßa e √°rea reduzida)
mamiferos_rede <- rownames(matriz_frugivoria)[
  rownames(matriz_frugivoria) %in% mamiferos
]

# Criar matriz sem mam√≠feros (√°rea fragmentada)
matriz_fragmento <- matriz_frugivoria[
  !rownames(matriz_frugivoria) %in% mamiferos_rede,
]
matriz_fragmento <- matriz_fragmento[, colSums(matriz_fragmento) > 0]
```

## Aplica√ß√£o 4: Resultados da Defauna√ß√£o üìâ

```{r}
cat("Mam√≠feros na rede original:", length(mamiferos_rede), "\n")
cat("Simula√ß√£o: perder TODOS os mam√≠feros\n\n")
cat("Esp√©cies restantes:", nrow(matriz_fragmento), "(s√≥ aves)\n")
cat("Plantas que perderam dispersores:", ncol(matriz_frugivoria) - ncol(matriz_fragmento), "\n")
```

## Impacto na Estrutura da Rede

```{r}
# Comparar m√©tricas
met_intacta <- networklevel(matriz_frugivoria, index = c("H2", "NODF"))
met_fragmento <- networklevel(matriz_fragmento, index = c("H2", "NODF"))

cat("√Årea Intacta ‚Üí Fragmento (s√≥ aves):\n\n")
cat("H2:", round(met_intacta["H2"], 2), "‚Üí", round(met_fragmento["H2"], 2), "\n")
cat("NODF:", round(met_intacta["NODF"], 2), "‚Üí", round(met_fragmento["NODF"], 2), "\n")
```

## Reflex√£o: A Floresta Vazia üëª

::: {.callout-important appearance="simple"}
## 1. Extin√ß√£o N√£o-Aleat√≥ria üéØ
A perda de mam√≠feros n√£o √© sorteio. Eles s√£o os primeiros a sumir (ca√ßa/√°rea).
**Consequ√™ncia:** Perda de fun√ß√µes espec√≠ficas que aves pequenas n√£o substituem.
:::

::: {.callout-warning appearance="simple"}
## 2. Qualidade da Dispers√£o üìâ
O c√≥digo mostra *quantas* plantas perdem dispersores, mas o problema real √© *quais*.
Sem mam√≠feros, √°rvores de sementes grandes (Cl√≠max) ficam sem dispers√£o, levando √† **S√≠ndrome da Floresta Vazia**.
:::



**Interpreta√ß√£o:** Perda de mam√≠feros = perda de fun√ß√£o ecol√≥gica completa

# S√≠ntese {.center background-color="#2C5F2D"}

## O que aprendemos

::: {.columns}
::: {.column width="33%"}
**Conceitos**

- Redes bipartidas
- Aninhamento
- Especializa√ß√£o
- Modelos nulos
:::

::: {.column width="33%"}
**M√©tricas**

- H2 (especializa√ß√£o)
- NODF (aninhamento)
- Grau, For√ßa, PDI
- Testes de signific√¢ncia
:::

::: {.column width="33%"}
**Aplica√ß√µes**

- Conserva√ß√£o
- Restaura√ß√£o
- Extin√ß√µes
- Defauna√ß√£o
:::
:::

**Ferramenta:** Pacote `bipartite` (R)

## Obrigado! {.center}

::::: columns
::: {.column width="40%"}
![](index_files/hex_sticker.png){width=80%}
:::

::: {.column width="60%"}
### **D√∫vidas?**

üìß **Contato:** higuchip@gmail.com
üêô **GitHub:** [github.com/higuchip](https://github.com/higuchip)
üåê **Material:** [higuchip.github.io/bipartite-networks-course](https://higuchip.github.io/bipartite-networks-course)

:::
:::::

